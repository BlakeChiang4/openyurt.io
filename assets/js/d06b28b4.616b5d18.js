"use strict";(self.webpackChunkopenyurt_io=self.webpackChunkopenyurt_io||[]).push([[6701],{3905:function(e,n,r){r.d(n,{Zo:function(){return p},kt:function(){return g}});var t=r(7294);function s(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function o(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),r.push.apply(r,t)}return r}function l(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?o(Object(r),!0).forEach((function(n){s(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))}))}return e}function i(e,n){if(null==e)return{};var r,t,s=function(e,n){if(null==e)return{};var r,t,s={},o=Object.keys(e);for(t=0;t<o.length;t++)r=o[t],n.indexOf(r)>=0||(s[r]=e[r]);return s}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(t=0;t<o.length;t++)r=o[t],n.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(s[r]=e[r])}return s}var a=t.createContext({}),u=function(e){var n=t.useContext(a),r=n;return e&&(r="function"==typeof e?e(n):l(l({},n),e)),r},p=function(e){var n=u(e.components);return t.createElement(a.Provider,{value:n},e.children)},c={inlineCode:"code",wrapper:function(e){var n=e.children;return t.createElement(t.Fragment,{},n)}},d=t.forwardRef((function(e,n){var r=e.components,s=e.mdxType,o=e.originalType,a=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),d=u(r),g=s,y=d["".concat(a,".").concat(g)]||d[g]||c[g]||o;return r?t.createElement(y,l(l({ref:n},p),{},{components:r})):t.createElement(y,l({ref:n},p))}));function g(e,n){var r=arguments,s=n&&n.mdxType;if("string"==typeof e||s){var o=r.length,l=new Array(o);l[0]=d;var i={};for(var a in n)hasOwnProperty.call(n,a)&&(i[a]=n[a]);i.originalType=e,i.mdxType="string"==typeof e?e:s,l[1]=i;for(var u=2;u<o;u++)l[u]=r[u];return t.createElement.apply(null,l)}return t.createElement.apply(null,r)}d.displayName="MDXCreateElement"},7126:function(e,n,r){r.r(n),r.d(n,{frontMatter:function(){return i},contentTitle:function(){return a},metadata:function(){return u},toc:function(){return p},default:function(){return d}});var t=r(7462),s=r(3366),o=(r(7294),r(3905)),l=["components"],i={title:"Edge Ingress"},a=void 0,u={unversionedId:"user-manuals/network/edge-ingress",id:"version-v0.5.0/user-manuals/network/edge-ingress",isDocsHomePage:!1,title:"Edge Ingress",description:"This document introduces how to access Edge services through Edge Ingress in Cloud Edge scenarios.",source:"@site/versioned_docs/version-v0.5.0/user-manuals/network/edge-ingress.md",sourceDirName:"user-manuals/network",slug:"/user-manuals/network/edge-ingress",permalink:"/docs/v0.5.0/user-manuals/network/edge-ingress",editUrl:"https://github.com/openyurtio/openyurt.io/edit/master/docs/user-manuals/network/edge-ingress.md",tags:[],version:"v0.5.0",lastUpdatedBy:"zzguang",lastUpdatedAt:1641261070,formattedLastUpdatedAt:"1/4/2022",frontMatter:{title:"Edge Ingress"},sidebar:"version-v0.5.0/docs",previous:{title:"Service Topology",permalink:"/docs/v0.5.0/user-manuals/network/service-topology"},next:{title:"Edge Local Storage",permalink:"/docs/v0.5.0/user-manuals/storage/edge-local-storage"}},p=[{value:"1.Enable the ingress feature on NodePools which provide your desired services",id:"1enable-the-ingress-feature-on-nodepools-which-provide-your-desired-services",children:[],level:2},{value:"2.Create and apply the ingress rule as K8S to access your desired services",id:"2create-and-apply-the-ingress-rule-as-k8s-to-access-your-desired-services",children:[],level:2}],c={toc:p};function d(e){var n=e.components,r=(0,s.Z)(e,l);return(0,o.kt)("wrapper",(0,t.Z)({},c,r,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"This document introduces how to access Edge services through Edge Ingress in Cloud Edge scenarios."),(0,o.kt)("p",null,"Generally, it only needs 2 steps to use the Edge Ingress feature:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Enable the ingress feature on NodePools which provide your desired services."),(0,o.kt)("li",{parentName:"ol"},"Create and apply the ingress rule as K8S to access your desired services.")),(0,o.kt)("p",null,"Follow the details below to try the Edge Ingress feature:"),(0,o.kt)("hr",null),(0,o.kt)("h2",{id:"1enable-the-ingress-feature-on-nodepools-which-provide-your-desired-services"},"1.Enable the ingress feature on NodePools which provide your desired services"),(0,o.kt)("p",null,"YurtIngress operator is responsible for deploying the nginx ingress controller to the corresponding NodePools.\nSuppose you have created 4 NodePools in your OpenYurt cluster: pool01, pool02, pool03, pool04, and you want to\nenable edge ingress feature on pool01 and pool03, you can create the YurtIngress CR as below:"),(0,o.kt)("p",null,"1). Create the YurtIngress CR yaml file: (for example: yurtingress-test.yaml)"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"  apiVersion: apps.openyurt.io/v1alpha1\n  kind: YurtIngress\n  metadata:\n    name: yurtingress-singleton\n  spec:\n      ingress_controller_replicas_per_pool: 1\n      pools:\n        - name: pool01\n        - name: pool03\n")),(0,o.kt)("p",null,"Notes:"),(0,o.kt)("p",null,'a). YurtIngress CR is a singleton instance from the cluster level, and the CR name must be "yurtingress-singleton".'),(0,o.kt)("p",null,'b). In spec, the "ingress_controller_replicas_per_pool" represents the ingress controller replicas deployed on every pool,\nIt is used for the HA usage scenarios.'),(0,o.kt)("p",null,'c). In spec, the "pools" represents the pools list on which you want to enable ingress feature.\nCurrently it only supports the pool name, but it can be extended to support pool personalized configruations in future.'),(0,o.kt)("p",null,"2). Apply the YurtIngress CR yaml file"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"kubectl apply -f yurtingress-test.yaml\nyurtingress.apps.openyurt.io/yurtingress-singleton created\n")),(0,o.kt)("p",null,"Then you can get the YurtIngress CR to check the status:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"kubectl get ying\nNAME                    NGINX-INGRESS-VERSION   REPLICAS-PER-POOL   READYNUM   NOTREADYNUM   AGE\nyurtingress-singleton   0.48.1                  1                   2          0             3m13s\n")),(0,o.kt)("p",null,"When the ingress controller is enabled successfully, a per-pool NodePort service is created to expose the ingress controller serivce:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"kubectl get svc -A\ningress-nginx   pool01-ingress-nginx-controller   NodePort    192.167.107.123   <none>    80:32255/TCP,443:32275/TCP   53m\ningress-nginx   pool03-ingress-nginx-controller   NodePort    192.167.48.114    <none>    80:30531/TCP,443:30916/TCP   53m\n")),(0,o.kt)("p",null,"Notes:"),(0,o.kt)("p",null,'a). "ying" is the shortName of YurtIngress resource.'),(0,o.kt)("p",null,"b). Currently YurtIngress only supports the fixed nginx ingress controller version, we will enhance it in future to support user configurable\nnginx ingress controller images/versions."),(0,o.kt)("p",null,'c). When the "READYNUM" equals the pool number you defined in the YurtIngress CR, it represents the ingress feature is ready on all the pool you defined.'),(0,o.kt)("p",null,'d). If the "NOTREADYNUM" is not 0 all the times, you can use "kubectl describe ying yurtingress-singleton" to check the details for the reasons.\nAlso you can check the corresponding deployment (xxx-ingress-nginx-controller, "xxx" represents the pool name) to figure out the reasons why the\ningress is not ready yet.'),(0,o.kt)("p",null,"e). For every NodePool which ingress is enable successfully, it exposes a NodePort type service for users to access the nginx ingress controller."),(0,o.kt)("hr",null),(0,o.kt)("h2",{id:"2create-and-apply-the-ingress-rule-as-k8s-to-access-your-desired-services"},"2.Create and apply the ingress rule as K8S to access your desired services"),(0,o.kt)("p",null,"When the step 1 above is done, you have successfully deployed the nginx ingress controller to the related NodePools, and the following\ningress user experience is totally consistent with K8S."),(0,o.kt)("p",null,"Suppose your app workload is deployed to several NodePools(e.g. pool01 and pool03), and it exposes a global service(e.g. myapp service), and you\nwant to access the service provided by pool01:"),(0,o.kt)("p",null,"1). Create the ingress rule yaml file: (for example: ingress-myapp.yaml)"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"apiVersion: extensions/v1beta1\nkind: Ingress\nmetadata:\n  name: ingress-myapp\n  annotations:\n    ingress.kubernetes.io/rewrite-target: /\nspec:\n  ingressclassName: pool01\n  rules:\n  - http:\n      paths:\n        - path: /myapp\n          backend:\n          serviceName: myapp-service\n          servicePort: xxx\n")),(0,o.kt)("p",null,"Notes:"),(0,o.kt)("p",null,"a). Ingress class decides which NodePool to provide the ingress capability, so you need to define the ingress class to your desired NodePool name."),(0,o.kt)("p",null,"b). The ingress CR definition may be different for different K8S versions, so you need ensure the CR definition matches with your cluster K8S version."),(0,o.kt)("p",null,"2). Apply the ingress rule yaml file:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"  kubectl apply -f ingress-myapp.yaml\n  ingress.extensions/ingress-myapp created\n")),(0,o.kt)("p",null,"After all the steps above are done successfully, you can verify the edge ingress feature through the ingress controller NodePort service:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'  curl xxx:32255/myapp\n\n  "xxx"     represents any NodeIP in NodePool pool01\n  "32255"   represents the NodePort which pool01 nginx ingress controller service exposes\n')))}d.isMDXComponent=!0}}]);