<!doctype html>
<html class="docs-version-current" lang="zh" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.9">
<link rel="alternate" type="application/rss+xml" href="/zh/blog/rss.xml" title="OpenYurt RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/zh/blog/atom.xml" title="OpenYurt Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="OpenYurt" href="/zh/opensearch.xml"><title data-react-helmet="true">Yurtctl | OpenYurt</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://openyurt.io/zh/docs/best-practices/yurtctl"><meta data-react-helmet="true" name="docsearch:language" content="zh"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Yurtctl | OpenYurt"><meta data-react-helmet="true" name="description" content="This tutorial demonstrates how to use yurtctl to install/uninstall OpenYurt."><meta data-react-helmet="true" property="og:description" content="This tutorial demonstrates how to use yurtctl to install/uninstall OpenYurt."><link data-react-helmet="true" rel="shortcut icon" href="/zh/img/openyurt.ico"><link data-react-helmet="true" rel="canonical" href="https://openyurt.io/zh/docs/best-practices/yurtctl"><link data-react-helmet="true" rel="alternate" href="https://openyurt.io/docs/best-practices/yurtctl" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://openyurt.io/zh/docs/best-practices/yurtctl" hreflang="zh"><link data-react-helmet="true" rel="alternate" href="https://openyurt.io/docs/best-practices/yurtctl" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/zh/assets/css/styles.4691cb76.css">
<link rel="preload" href="/zh/assets/js/runtime~main.204d2ddb.js" as="script">
<link rel="preload" href="/zh/assets/js/main.8d56fd25.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><div class="announcementBar_axC9" role="banner"><div class="announcementBarPlaceholder_xYHE"></div><div class="announcementBarContent_6uhP">⭐️ If you like OpenYurt, give it a star on <a target="_blank" rel="noopener noreferrer" href="https://github.com/openyurtio/openyurt">GitHub</a>! ⭐️</div><button type="button" class="clean-btn close announcementBarClose_A3A1" aria-label="Close"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/zh/"><div class="navbar__logo"><img src="/zh/img/openyurt.ico" alt="OpenYurt" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/zh/img/openyurt.ico" alt="OpenYurt" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title">OpenYurt</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/zh/docs/">文档</a><a class="navbar__item navbar__link" href="/zh/blog">博客</a></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/zh/docs/">Next</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link"><span><svg viewBox="0 0 20 20" width="20" height="20" aria-hidden="true" class="iconLanguage_EbrZ"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>简体中文</span></span></a><ul class="dropdown__menu"><li><a href="/docs/best-practices/yurtctl" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">English</a></li><li><a href="/zh/docs/best-practices/yurtctl" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" style="text-transform:capitalize">简体中文</a></li></ul></div><a href="https://github.com/openyurtio/openyurt" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link"></a><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">🌜</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">🌞</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div><div class="searchBox_NKBi"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh menuWithAnnouncementBar_+O1J"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist" href="#">快速开始</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/docs/">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Install</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist" href="#">核心概念</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/docs/core-concepts/architecture">Architecture</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">最佳实践</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/docs/best-practices/yurt-app-manager">Yurt App Manager</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/docs/best-practices/yurt-tunnel">Yurt tunnel</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/zh/docs/best-practices/yurtctl">Yurtctl</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">用户手册</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">开发者手册</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Roadmap</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh/docs/faq">FAQ</a></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Yurtctl</h1></header><p>This tutorial demonstrates how to use <code>yurtctl</code> to install/uninstall OpenYurt.
Please refer to the <a href="https://github.com/openyurtio/openyurt#getting-started" target="_blank" rel="noopener noreferrer">Getting Started</a> section on the README page to prepare and build binary to <code>_output/bin/yurtctl</code>.
We assume a minikube cluster (<a href="https://github.com/kubernetes/minikube/releases/tag/v1.0.0" target="_blank" rel="noopener noreferrer">version 1.14 or less</a>)
is installed.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="convert-a-minikube-cluster">Convert a minikube cluster<a aria-hidden="true" class="hash-link" href="#convert-a-minikube-cluster" title="Direct link to heading">​</a></h2><p>Let us use <code>yurtctl</code> to convert a standard Kubernetes cluster to an OpenYurt cluster.</p><ol><li>Run the following command</li></ol><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ _output/bin/yurtctl convert --provider minikube</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ol start="2"><li><code>yurtctl</code> will install all required components and reset the kubelet in the edge node. The output looks like:</li></ol><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">convert.go:148</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> mark minikube as the edge-node</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">convert.go:178</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> deploy the yurt controller manager</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">convert.go:190</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> deploying the yurt-hub and resetting the kubelet service</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">util.go:137</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> servant job</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">yurtctl-servant-convert-minikube</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> has succeeded</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ol start="3"><li>yurt controller manager and yurthub Pods will be up and running in one minute. Let us verify them:</li></ol><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ kubectl get deploy yurt-controller-manager -n kube-system</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">NAME            READY   UP-TO-DATE   AVAILABLE   AGE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">yurt-ctrl-mgr   </span><span class="token number">1</span><span class="token plain">/1     </span><span class="token number">1</span><span class="token plain">            </span><span class="token number">1</span><span class="token plain">           23h</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ kubectl get po yurt-hub-minikube -n kube-system</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">NAME                READY   STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">yurt-hub-minikube   </span><span class="token number">1</span><span class="token plain">/1     Running   </span><span class="token number">0</span><span class="token plain">          23h</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ol start="4"><li>Next, we mark desired edge nodes as autonomous (only pods running on the autonomous edge nodes will be prevented from being evicted during disconnection):</li></ol><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ _output/bin/yurtctl markautonomous</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">I0602 </span><span class="token number">14</span><span class="token plain">:11:08.610222   </span><span class="token number">89160</span><span class="token plain"> markautonomous.go:149</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> mark minikube-m02 as autonomous</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ol start="5"><li>As the minikube cluster only contains one node, the node will be marked as an autonomous edge node. Let us verify this by inspecting the node&#x27;s labels and annotations:</li></ol><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ kubectl describe node | grep Labels -A 5</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Labels:      alibabacloud.com/is-edge-worker=true</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ kubectl describe node | grep Annotations -A 5</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Annotations: node.beta.alibabacloud.com/autonomy: true</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>By now, the OpenYurt cluster is ready. Users will not notice any differences compared to native Kubernetes when operating the cluster.
If you login to the node, you will find the local cache has been populated:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ minikube ssh</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ ls /etc/kubernetes/cache/kubelet/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">configmaps  events  leases  nodes  pods  secrets  services</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="test-node-autonomy">Test node autonomy<a aria-hidden="true" class="hash-link" href="#test-node-autonomy" title="Direct link to heading">​</a></h3><p>To test if edge node autonomy works as expected, we will simulate a node &quot;offline&quot; scenario.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">kubectl apply -f-</span><span class="token operator">&lt;&lt;</span><span class="token string" style="color:rgb(255, 121, 198)">EOF</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">apiVersion: v1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">kind: Pod</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">metadata:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">  name: bbox</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">spec:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">  containers:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">  - image: busybox</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">    command:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">    - top</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">    name: bbox</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">EOF</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ol start="2"><li>Make the edge node &quot;offline&quot; by changing the <code>yurthub</code>&#x27;s server-addr to an unreachable address:</li></ol><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ minikube </span><span class="token function" style="color:rgb(80, 250, 123)">ssh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ </span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">sed</span><span class="token plain"> -i </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;s|--server-addr=.*|--server-addr=https://1.1.1.1:1111|&#x27;</span><span class="token plain"> /etc/kubernetes/manifests/yurt-hub.yaml</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ol start="3"><li>Now <code>yurthub</code> is disconnected from the apiserver and works in offline mode. To verify this, we can do the following:</li></ol><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ minikube </span><span class="token function" style="color:rgb(80, 250, 123)">ssh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ </span><span class="token function" style="color:rgb(80, 250, 123)">curl</span><span class="token plain"> -s </span><span class="token operator">&lt;</span><span class="token plain">http://127.0.0.1:1026</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;kind&quot;</span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Status&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;metadata&quot;</span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;status&quot;</span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Failure&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;message&quot;</span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;request( get : /) is not supported when cluster is unhealthy&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;reason&quot;</span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;BadRequest&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;code&quot;</span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token plain"> </span><span class="token number">400</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ol start="4"><li>After 40 seconds, the edge node status becomes <code>NotReady</code>, but the pod/bbox won&#x27;t be evicted and keeps running on the node:</li></ol><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ kubectl get node </span><span class="token operator">&amp;&amp;</span><span class="token plain"> kubectl get po</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">NAME       STATUS     ROLES    AGE   VERSION</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">minikube   NotReady   master   58m   v1.18.2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">NAME   READY   STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">bbox   </span><span class="token number">1</span><span class="token plain">/1     Running   </span><span class="token number">0</span><span class="token plain">          19m</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="convert-a-multi-nodes-kubernetes-cluster">Convert a multi-nodes Kubernetes cluster<a aria-hidden="true" class="hash-link" href="#convert-a-multi-nodes-kubernetes-cluster" title="Direct link to heading">​</a></h2><p>An OpenYurt cluster may consist of some edge nodes and some nodes in the cloud site.
<code>yurtctl</code> allows users to specify a list of cloud nodes that won&#x27;t be converted.</p><ol><li>Start with a <a href="https://cn.aliyun.com/product/kubernetes" target="_blank" rel="noopener noreferrer">two-nodes ack cluster</a>,</li></ol><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ kubectl get node</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">NAME                     STATUS   ROLES    AGE   VERSION</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">us-west-1.192.168.0.87   Ready    </span><span class="token operator">&lt;</span><span class="token plain">none</span><span class="token operator">&gt;</span><span class="token plain">   19h   v1.14.8-aliyun.1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">us-west-1.192.168.0.88   Ready    </span><span class="token operator">&lt;</span><span class="token plain">none</span><span class="token operator">&gt;</span><span class="token plain">   19h   v1.14.8-aliyun.1</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ol start="2"><li>You can convert only one node to edge node(i.e., minikube-m02) by using this command:</li></ol><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ _output/bin/yurtctl convert --provider ack --cloud-nodes us-west-1.192.168.0.87</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">I0529 </span><span class="token number">11</span><span class="token plain">:21:05.835781    </span><span class="token number">9231</span><span class="token plain"> convert.go:145</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> mark us-west-1.192.168.0.87 as the cloud-node</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">I0529 </span><span class="token number">11</span><span class="token plain">:21:05.861064    </span><span class="token number">9231</span><span class="token plain"> convert.go:153</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> mark us-west-1.192.168.0.88 as the edge-node</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">I0529 </span><span class="token number">11</span><span class="token plain">:21:05.951483    </span><span class="token number">9231</span><span class="token plain"> convert.go:183</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> deploy the yurt controller manager</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">I0529 </span><span class="token number">11</span><span class="token plain">:21:05.974443    </span><span class="token number">9231</span><span class="token plain"> convert.go:195</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> deploying the yurt-hub and resetting the kubelet service</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">I0529 </span><span class="token number">11</span><span class="token plain">:21:26.075075    </span><span class="token number">9231</span><span class="token plain"> util.go:147</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> servant job</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">yurtctl-servant-convert-us-west-1.192.168.0.88</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> has succeeded</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ol start="3"><li>Node <code>us-west-1.192.168.0.87</code> will be marked as a non-edge node. You can verify this by inspecting its labels:</li></ol><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ kubectl describe node us-west-1.192.168.0.87 </span><span class="token operator">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">grep</span><span class="token plain"> Labels</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Labels:             openyurt.io/is-edge-worker</span><span class="token operator">=</span><span class="token plain">false</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ol start="4"><li>Same as before, we make desired edge nodes autonomous:</li></ol><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ _output/bin/yurtctl markautonomous</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">I0602 </span><span class="token number">11</span><span class="token plain">:22:05.610222   </span><span class="token number">89160</span><span class="token plain"> markautonomous.go:149</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> mark us-west-1.192.168.0.88 as autonomous</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ol start="5"><li>When the OpenYurt cluster contains cloud nodes, yurt controller manager will be deployed on the cloud node (in this case, the node <code>us-west-1.192.168.0.87</code>):</li></ol><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ kubectl get pods -A -o</span><span class="token operator">=</span><span class="token plain">custom-columns</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;NAME:.metadata.name,NODE:.spec.nodeName&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">NAME                                               NODE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">yurt-controller-manager-6947f6f748-lxfdx           us-west-1.192.168.0.87</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="setup-yurttunnel">Setup Yurttunnel<a aria-hidden="true" class="hash-link" href="#setup-yurttunnel" title="Direct link to heading">​</a></h2><p>Since version v0.2.0, users can setup the yurttunnel using <code>yurtctl convert</code>.</p><p>Assume that the origin cluster is a two-nodes minikube cluster:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ kubectl get node -o wide</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">NAME           STATUS   ROLES    AGE   VERSION   INTERNAL-IP   EXTERNAL-IP   OS-IMAGE           KERNEL-VERSION     CONTAINER-RUNTIME</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">minikube       Ready    master   72m   v1.18.3   </span><span class="token number">172.17</span><span class="token plain">.0.3    </span><span class="token operator">&lt;</span><span class="token plain">none</span><span class="token operator">&gt;</span><span class="token plain">        Ubuntu </span><span class="token number">20.04</span><span class="token plain"> LTS   </span><span class="token number">4.19</span><span class="token plain">.76-linuxkit   docker://19.3.8</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">minikube-m02   Ready    </span><span class="token operator">&lt;</span><span class="token plain">none</span><span class="token operator">&gt;</span><span class="token plain">   71m   v1.18.3   </span><span class="token number">172.17</span><span class="token plain">.0.4    </span><span class="token operator">&lt;</span><span class="token plain">none</span><span class="token operator">&gt;</span><span class="token plain">        Ubuntu </span><span class="token number">20.04</span><span class="token plain"> LTS   </span><span class="token number">4.19</span><span class="token plain">.76-linuxkit   docker://19.3.8</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Then, by simply running the <code>yurtctl convert</code> command with the enabling of the option <code>--deploy-yurttunnel</code>,
yurttunnel servers will be deployed on cloud nodes, and an yurttunnel agent will be deployed on every edge node.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ yurtctl convert --deploy-yurttunnel --cloud-nodes minikube --provider minikube</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">I0831 </span><span class="token number">12</span><span class="token plain">:35:51.719391   </span><span class="token number">77322</span><span class="token plain"> convert.go:214</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> mark minikube as the cloud-node</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">I0831 </span><span class="token number">12</span><span class="token plain">:35:51.728246   </span><span class="token number">77322</span><span class="token plain"> convert.go:222</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> mark minikube-m02 as the edge-node</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">I0831 </span><span class="token number">12</span><span class="token plain">:35:51.753830   </span><span class="token number">77322</span><span class="token plain"> convert.go:251</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> the yurt-controller-manager is deployed</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">I0831 </span><span class="token number">12</span><span class="token plain">:35:51.910440   </span><span class="token number">77322</span><span class="token plain"> convert.go:270</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> yurt-tunnel-server is deployed</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">I0831 </span><span class="token number">12</span><span class="token plain">:35:51.999384   </span><span class="token number">77322</span><span class="token plain"> convert.go:278</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> yurt-tunnel-agent is deployed</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">I0831 </span><span class="token number">12</span><span class="token plain">:35:51.999409   </span><span class="token number">77322</span><span class="token plain"> convert.go:282</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> deploying the yurt-hub and resetting the kubelet service</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">I0831 </span><span class="token number">12</span><span class="token plain">:36:22.109338   </span><span class="token number">77322</span><span class="token plain"> util.go:173</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> servant job</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">yurtctl-servant-convert-minikube-m02</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> has succeeded</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">I0831 </span><span class="token number">12</span><span class="token plain">:36:22.109368   </span><span class="token number">77322</span><span class="token plain"> convert.go:292</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> the yurt-hub is deployed</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>To verify that the yurttunnel works as expected, please refer to
the <a href="https://github.com/openyurtio/openyurt/blob/master/docs/tutorial/yurt-tunnel.md" target="_blank" rel="noopener noreferrer">yurttunnel tutorial</a></p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="set-the-path-of-configuration">Set the path of configuration<a aria-hidden="true" class="hash-link" href="#set-the-path-of-configuration" title="Direct link to heading">​</a></h2><p>Sometimes the configuration of the node may be different. Users can set the path of the kubelet service configuration
by the option <code>--kubeadm-conf-path</code>, which is used by kubelet component to join the cluster on the edge node.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ _output/bin/yurtctl convert --kubeadm-conf-path /etc/systemd/system/kubelet.service.d/10-kubeadm.conf</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The path of the directory on edge node containing static pod files can be set by the
option <code>--pod-manifest-path</code>.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ _output/bin/yurtctl convert --pod-manifest-path /etc/kubernetes/manifests</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="revertuninstall-openyurt">Revert/Uninstall OpenYurt<a aria-hidden="true" class="hash-link" href="#revertuninstall-openyurt" title="Direct link to heading">​</a></h2><p>Using <code>yurtctl</code> to revert an OpenYurt cluster can be done by doing the following:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ _output/bin/yurtctl revert</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">revert.go:100] label alibabacloud.com/is-edge-worker is removed</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">revert.go:110] yurt controller manager is removed</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">revert.go:124] ServiceAccount node-controller is created</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">util.go:137] servant job(yurtctl-servant-revert-minikube-m02) has succeeded</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">revert.go:133] yurt-hub is removed, kubelet service is reset</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Note that before performing the uninstall, please make sure all edge nodes are reachable from the apiserver.</p><p>In addition, the path of the kubelet service configuration can be set by the option <code>--kubeadm-conf-path</code>,
and the path of the directory on edge node containing static pod files can be set by the option <code>--pod-manifest-path</code>.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="subcommand">Subcommand<a aria-hidden="true" class="hash-link" href="#subcommand" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="convert-a-kubernetes-node-to-yurt-edge-node">Convert a Kubernetes node to Yurt edge node<a aria-hidden="true" class="hash-link" href="#convert-a-kubernetes-node-to-yurt-edge-node" title="Direct link to heading">​</a></h3><p>You can use the subcommand <code>yurtctl convert edgenode</code> to convert a Kubernetes node to Yurt edge node separately.</p><p>This command can convert the node locally or remotely. One or more nodes that need to be converted can be specified
by the option <code>--edge-nodes</code>. If this option is not used, the local node will be converted.</p><p>Convert the Kubernetes node n80 to an Yurt edge node:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ _output/bin/yurtctl convert edgenode --edge-nodes n80</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">I0209 11:03:30.101308   13729 edgenode.go:251] mark n80 as the edge-node</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">I0209 11:03:30.136313   13729 edgenode.go:279] setting up yurthub on node</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">I0209 11:03:30.137013   13729 edgenode.go:294] setting up yurthub apiserver addr</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">I0209 11:03:30.137500   13729 edgenode.go:311] create the /etc/kubernetes/manifests/yurt-hub.yaml</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">I0209 11:03:40.140073   13729 edgenode.go:403] yurt-hub healthz is OK</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">I0209 11:03:40.140555   13729 edgenode.go:330] revised kubeconfig /var/lib/openyurt/kubelet.conf is generated</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">I0209 11:03:40.141592   13729 edgenode.go:351] kubelet.service drop-in file is revised</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">I0209 11:03:40.141634   13729 edgenode.go:354] systemctl daemon-reload</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">I0209 11:03:40.403453   13729 edgenode.go:359] systemctl restart kubelet</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">I0209 11:03:40.469911   13729 edgenode.go:364] kubelet has been restarted</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>You can verify this by inspecting its labels and getting the status of pod yurt-hub.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="revert-an-yurt-edge-node-to-kubernetes-node">Revert an Yurt edge node to Kubernetes node<a aria-hidden="true" class="hash-link" href="#revert-an-yurt-edge-node-to-kubernetes-node" title="Direct link to heading">​</a></h3><p>The subcommand <code>yurtctl revert edgenode</code> can revert a Yurt edge node. The option <code>--edge-nodes</code> of command can be used
to specify one or more nodes to be reverted which is the same as the <code>yurtctl convert edgenode</code>.</p><p>Assume that the cluster is an OpenYurt cluster and has an Yurt edge node n80:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ kubectl describe node n80 | grep Labels</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Labels:             openyurt.io/is-edge-worker=true</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ kubectl get pod -A | grep yurt-hub</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">kube-system   yurt-hub-n80               1/1     Running   0          7m32s</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Using <code>yurtctl revert edgenode</code> to revert:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ _output/bin/yurtctl revert edgenode --edge-nodes n80</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">I0209 11:01:46.837812   12217 edgenode.go:225] label alibabacloud.com/is-edge-worker is removed</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">I0209 11:01:46.838454   12217 edgenode.go:252] found backup file /etc/systemd/system/kubelet.service.d/10-kubeadm.conf.bk, will use it to revert the node</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">I0209 11:01:46.838689   12217 edgenode.go:259] systemctl daemon-reload</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">I0209 11:01:47.085554   12217 edgenode.go:265] systemctl restart kubelet</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">I0209 11:01:47.153388   12217 edgenode.go:270] kubelet has been reset back to default</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">I0209 11:01:47.153680   12217 edgenode.go:282] yurt-hub has been removed</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>You can verify this by inspecting its labels and getting the status of pod yurt-hub.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="troubleshooting">Troubleshooting<a aria-hidden="true" class="hash-link" href="#troubleshooting" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="1-failure-due-to-pulling-image-timeout">1. Failure due to pulling image timeout<a aria-hidden="true" class="hash-link" href="#1-failure-due-to-pulling-image-timeout" title="Direct link to heading">​</a></h3><p>The default timeout value of cluster conversion is 2 minutes. Sometimes pulling the related images
might take more than 2 minutes. To avoid the conversion failure due to pulling images timeout, you can:</p><ul><li>use mirrored image from aliyun container registry(ACR)</li></ul><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ _output/bin/yurtctl convert --provider minikube </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --yurt-controller-manager-image registry.cn-hangzhou.aliyuncs.com/openyurt/yurt-controller-manager:latest </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --yurt-tunnel-agent-image registry.cn-hangzhou.aliyuncs.com/openyurt/yurt-tunnel-agent:latest </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --yurt-tunnel-server-image registry.cn-hangzhou.aliyuncs.com/openyurt/yurt-tunnel-server:latest </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --yurtctl-servant-image registry.cn-hangzhou.aliyuncs.com/openyurt/yurtctl-servant:latest </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --yurthub-image registry.cn-hangzhou.aliyuncs.com/openyurt/yurthub:latest</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ul><li>or pull all images on the node manually
or use automation tools such as <code>broadcastjob</code>(from <a href="https://github.com/openkruise/kruise/blob/master/docs/tutorial/broadcastjob.md" target="_blank" rel="noopener noreferrer">Kruise</a>) in advance.</li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="2-adhoc-failure-recovery">2. Adhoc failure recovery<a aria-hidden="true" class="hash-link" href="#2-adhoc-failure-recovery" title="Direct link to heading">​</a></h3><p>In case any adhoc failure makes the Kubelet fail to communicate with APIServer, one can recover the original Kubelet setup by
running the following command in edge node directly:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ sudo sed -i &quot;s|--kubeconfig=.*kubelet.conf|--kubeconfig=/etc/kubernetes/kubelet.conf|g;&quot; /etc/systemd/system/kubelet.service.d/10-kubeadm.conf &amp;&amp; sudo systemctl daemon-reload &amp;&amp; sudo systemctl restart kubelet.service</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/openyurtio/openyurt.io/edit/master/docs/best-practices/yurtctl.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑本页</a></div><div class="col lastUpdated_mt2f"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2021-11-17T06:39:32.000Z">2021/11/17</time></b> by <b>Peeknut</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/zh/docs/best-practices/yurt-tunnel"><div class="pagination-nav__sublabel">上一篇</div><div class="pagination-nav__label">« <!-- -->Yurt tunnel</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/zh/docs/user-manuals/yurt-app-manager/yurt-app-manager-dev"><div class="pagination-nav__sublabel">下一篇</div><div class="pagination-nav__label">Build and deploy<!-- --> »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#convert-a-minikube-cluster" class="table-of-contents__link toc-highlight">Convert a minikube cluster</a><ul><li><a href="#test-node-autonomy" class="table-of-contents__link toc-highlight">Test node autonomy</a></li></ul></li><li><a href="#convert-a-multi-nodes-kubernetes-cluster" class="table-of-contents__link toc-highlight">Convert a multi-nodes Kubernetes cluster</a></li><li><a href="#setup-yurttunnel" class="table-of-contents__link toc-highlight">Setup Yurttunnel</a></li><li><a href="#set-the-path-of-configuration" class="table-of-contents__link toc-highlight">Set the path of configuration</a></li><li><a href="#revertuninstall-openyurt" class="table-of-contents__link toc-highlight">Revert/Uninstall OpenYurt</a></li><li><a href="#subcommand" class="table-of-contents__link toc-highlight">Subcommand</a><ul><li><a href="#convert-a-kubernetes-node-to-yurt-edge-node" class="table-of-contents__link toc-highlight">Convert a Kubernetes node to Yurt edge node</a></li><li><a href="#revert-an-yurt-edge-node-to-kubernetes-node" class="table-of-contents__link toc-highlight">Revert an Yurt edge node to Kubernetes node</a></li></ul></li><li><a href="#troubleshooting" class="table-of-contents__link toc-highlight">Troubleshooting</a><ul><li><a href="#1-failure-due-to-pulling-image-timeout" class="table-of-contents__link toc-highlight">1. Failure due to pulling image timeout</a></li><li><a href="#2-adhoc-failure-recovery" class="table-of-contents__link toc-highlight">2. Adhoc failure recovery</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">文档</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/zh/docs/manually-setup">快速开始</a></li></ul></div><div class="col footer__col"><div class="footer__title">社区</div><ul class="footer__items"><li class="footer__item"><a href="https://join.slack.com/t/openyurt/shared_invite/zt-rc5ecz4h-sEWU1vYx5gzc3_zx3En0jg" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>CNCF Slack ( #openyurt channel )<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a class="footer__link-item" href="/zh/docs/best-practices/">钉钉 (31993519)</a></li><li class="footer__item"><a href="https://shimo.im/docs/rGK3cXYWYkPrvWp8" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Bi-week Meeting (APAC, Chinese)<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">更多</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/openyurtio/openyurt" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/openyurtio/community/blob/main/community-membership.md" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Community Membership<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">
        <br>
        <strong>Copyright © 2021 The OpenYurt Authors. All rights reserved. The Linux Foundation has registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our <a href="https://www.linuxfoundation.org/trademark-usage/"> Trademark Usage</a> page.</strong></div></div></div></footer></div>
<script src="/zh/assets/js/runtime~main.204d2ddb.js"></script>
<script src="/zh/assets/js/main.8d56fd25.js"></script>
</body>
</html>